@if (Show)
{
    <div class="fixed top-4 right-4 z-[100] toast-slide-in @(isClosing ? "toast-slide-out" : "")">
        @if (IsOnline)
        {
            <!-- Online Toast -->
            <div class="flex min-w-[280px] max-w-md items-center gap-3 rounded-lg border border-green-200 bg-green-50 px-4 py-3 shadow-lg">
                <!-- Online Icon -->
                <div class="flex-shrink-0">
                    <div class="flex h-6 w-6 items-center justify-center rounded-full bg-green-500">
                        <svg class="h-4 w-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                    </div>
                </div>
                
                <!-- Content -->
                <div class="flex-1">
                    <p class="text-sm font-medium text-gray-800">@Message</p>
                </div>
                
                <!-- Close Button -->
                <button @onclick="CloseToast" class="flex-shrink-0 text-gray-700 hover:text-gray-900 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        }
        else
        {
            <!-- Offline Toast -->
            <div class="flex min-w-[280px] max-w-md items-center gap-3 rounded-lg border border-red-200 bg-red-50 px-4 py-3 shadow-lg">
                <!-- Offline Icon -->
                <div class="flex-shrink-0">
                    <div class="flex h-6 w-6 items-center justify-center rounded-full bg-red-500">
                        <svg class="h-4 w-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
                        </svg>
                    </div>
                </div>
                
                <!-- Content -->
                <div class="flex-1">
                    <p class="text-sm font-medium text-gray-800">@Message</p>
                </div>
                
                <!-- Close Button -->
                <button @onclick="CloseToast" class="flex-shrink-0 text-gray-700 hover:text-gray-900 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        }
    </div>
}

@implements IDisposable

@code {
    [Parameter] public bool Show { get; set; }
    [Parameter] public bool IsOnline { get; set; }
    [Parameter] public string Message { get; set; } = "";
    [Parameter] public int Duration { get; set; } = 5000;
    [Parameter] public EventCallback OnClose { get; set; }

    private System.Threading.Timer? _timer;
    private bool isClosing = false;

    protected override void OnParametersSet()
    {
        if (Show && Duration > 0)
        {
            isClosing = false;
            _timer?.Dispose();
            _timer = new System.Threading.Timer(async _ =>
            {
                await InvokeAsync(async () =>
                {
                    await CloseToast();
                });
            }, null, Duration, Timeout.Infinite);
        }
        else if (!Show)
        {
            _timer?.Dispose();
            _timer = null;
            isClosing = false;
        }
    }

    private async Task CloseToast()
    {
        isClosing = true;
        StateHasChanged();
        
        // Wait for slide-out animation
        await Task.Delay(300);
        
        Show = false;
        isClosing = false;
        await OnClose.InvokeAsync();
        StateHasChanged();
    }

    public void Dispose()
    {
        _timer?.Dispose();
    }
}

