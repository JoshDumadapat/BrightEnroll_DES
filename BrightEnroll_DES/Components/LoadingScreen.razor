@using BrightEnroll_DES.Services
@inject ILoadingService LoadingService
@implements IDisposable

@if (LoadingService.IsLoading)
{
    <div class="fixed inset-0 z-[9999] flex items-center justify-center bg-white" style="transition: opacity 0.2s ease-in-out;">
        <div class="flex flex-col items-center gap-4">
            <!-- Spinner -->
            <div class="relative">
                <div class="h-16 w-16 animate-spin rounded-full border-4 border-blue-200 border-t-blue-600"></div>
            </div>
            
            <!-- Loading Text -->
            <div class="text-center">
                <p class="text-lg font-semibold text-gray-800">@LoadingService.LoadingMessage</p>
                <p class="mt-2 text-sm text-gray-600">Please wait...</p>
            </div>
        </div>
    </div>
}

@code {
    private bool _isLoading = false;
    
    protected override void OnInitialized()
    {
        _isLoading = LoadingService.IsLoading;
        LoadingService.OnLoadingStateChanged += OnLoadingStateChanged;
    }

    private void OnLoadingStateChanged()
    {
        // Only update if state actually changed to prevent unnecessary re-renders
        var newLoadingState = LoadingService.IsLoading;
        if (_isLoading != newLoadingState)
        {
            _isLoading = newLoadingState;
            // Use InvokeAsync to ensure UI thread update
            InvokeAsync(StateHasChanged);
        }
    }

    public void Dispose()
    {
        LoadingService.OnLoadingStateChanged -= OnLoadingStateChanged;
    }
}

