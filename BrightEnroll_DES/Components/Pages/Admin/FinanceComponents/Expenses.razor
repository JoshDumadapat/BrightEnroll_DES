@using BrightEnroll_DES.Components.Pages.Admin.FinanceComponents

<div class="p-6">
    <h2 class="mb-4 text-lg font-bold text-orange-600">Expense Details</h2>
    <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
        <div>
            <label class="mb-2 block text-sm font-medium text-gray-700">Expense ID:</label>
            <input type="text" @bind="ExpenseForm.ExpenseId"
                   class="w-full rounded-lg border border-gray-300 bg-gray-100 px-3 py-2 text-sm text-gray-700 outline-none"
                   readonly />
        </div>
        <div>
            <label class="mb-2 block text-sm font-medium text-gray-700">Expense Category:</label>
            <select @bind="ExpenseForm.Category"
                    class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 outline-none focus:border-gray-300 focus:ring-2 focus:ring-orange-400">
                <option value="">Select category</option>
                <option value="Utilities">Utilities (Water, Electricity, Internet)</option>
                <option value="Office Supplies">Office Supplies</option>
                <option value="Teaching Materials">Teaching Materials</option>
                <option value="Equipment & Maintenance">Equipment &amp; Maintenance</option>
                <option value="Salaries / Honorarium">Salaries / Honorarium</option>
                <option value="Events / Activities">Events / Activities</option>
                <option value="Miscellaneous">Miscellaneous</option>
            </select>
        </div>
        <div class="md:col-span-2">
            <label class="mb-2 block text-sm font-medium text-gray-700">Expense Description:</label>
            <textarea @bind="ExpenseForm.Description"
                      class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 outline-none focus:border-gray-300 focus:ring-2 focus:ring-orange-400"
                      rows="3"
                      placeholder="Describe the expense..."></textarea>
        </div>
        <div>
            <label class="mb-2 block text-sm font-medium text-gray-700">Amount:</label>
            <input type="text" @bind="ExpenseForm.Amount"
                   placeholder="Php 0.00"
                   class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 outline-none focus:border-gray-300 focus:ring-2 focus:ring-orange-400" />
        </div>
        <div>
            <label class="mb-2 block text-sm font-medium text-gray-700">Expense Date:</label>
            <input type="date" @bind="ExpenseForm.ExpenseDate"
                   class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 outline-none focus:border-gray-300 focus:ring-2 focus:ring-orange-400" />
        </div>
        <div>
            <label class="mb-2 block text-sm font-medium text-gray-700">Payee / Supplier:</label>
            <input type="text" @bind="ExpenseForm.Payee"
                   class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 outline-none focus:border-gray-300 focus:ring-2 focus:ring-orange-400"
                   placeholder="Enter supplier or payee" />
        </div>
        <div>
            <label class="mb-2 block text-sm font-medium text-gray-700">OR / Receipt Number:</label>
            <input type="text" @bind="ExpenseForm.OrNumber"
                   class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 outline-none focus:border-gray-300 focus:ring-2 focus:ring-orange-400"
                   placeholder="Enter OR or receipt number" />
        </div>
        <div>
            <label class="mb-2 block text-sm font-medium text-gray-700">Payment Method:</label>
            <select @bind="ExpenseForm.PaymentMethod"
                    class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 outline-none focus:border-gray-300 focus:ring-2 focus:ring-orange-400">
                <option value="Cash">Cash</option>
                <option value="Cheque">Cheque</option>
                <option value="Bank Transfer">Bank Transfer</option>
                <option value="GCash">GCash</option>
                <option value="E-wallet">E-wallet</option>
            </select>
        </div>
        <div>
            <label class="mb-2 block text-sm font-medium text-gray-700">Status:</label>
            <select @bind="ExpenseForm.Status"
                    class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 outline-none focus:border-gray-300 focus:ring-2 focus:ring-orange-400">
                <option value="Pending">Pending</option>
                <option value="Approved">Approved</option>
                <option value="Rejected">Rejected</option>
                <option value="Paid">Paid</option>
            </select>
        </div>
        <div>
            <label class="mb-2 block text-sm font-medium text-gray-700">Recorded By:</label>
            <input type="text" @bind="ExpenseForm.RecordedBy"
                   class="w-full rounded-lg border border-gray-300 bg-gray-100 px-3 py-2 text-sm text-gray-700 outline-none"
                   readonly />
        </div>
        <div>
            <label class="mb-2 block text-sm font-medium text-gray-700">Approved By:</label>
            <input type="text" @bind="ExpenseForm.ApprovedBy"
                   class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 outline-none focus:border-gray-300 focus:ring-2 focus:ring-orange-400"
                   placeholder="Enter approver name" />
        </div>
        <div class="md:col-span-2">
            <label class="mb-2 block text-sm font-medium text-gray-700">Attachments:</label>
            <input type="file"
                   class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 outline-none focus:border-gray-300 focus:ring-2 focus:ring-orange-400" />
            <p class="mt-1 text-xs text-gray-400">Upload receipts, invoices, or supporting documents.</p>
        </div>
    </div>
    <div class="mt-6 flex justify-end gap-3">
        <button type="button" @onclick="ClearExpenseForm"
                class="rounded-lg bg-gray-500 px-6 py-2.5 text-sm font-semibold text-white shadow-md transition-all duration-300 hover:bg-gray-600 hover:shadow-lg">
            Clear
        </button>
        <button type="button" @onclick="SaveExpense"
                class="rounded-lg bg-orange-500 px-6 py-2.5 text-sm font-semibold text-white shadow-md transition-all duration-300 hover:bg-orange-600 hover:shadow-lg">
            Save Expense
        </button>
    </div>
</div>

@code {
    [Parameter] public ExpenseFormModel ExpenseForm { get; set; } = new();
    [Parameter] public EventCallback<ExpenseFormModel> OnExpenseSaved { get; set; }

    protected override void OnInitialized()
    {
        if (string.IsNullOrWhiteSpace(ExpenseForm.ExpenseId))
        {
            ExpenseForm.ExpenseId = $"EXP-{DateTime.Now:yyyyMMddHHmmss}";
        }
        if (ExpenseForm.ExpenseDate == default)
        {
            ExpenseForm.ExpenseDate = DateTime.Now;
        }
    }

    private void ClearExpenseForm()
    {
        ExpenseForm = new ExpenseFormModel
        {
            ExpenseId = $"EXP-{DateTime.Now:yyyyMMddHHmmss}",
            RecordedBy = "Admin User",
            ExpenseDate = DateTime.Now,
            PaymentMethod = "Cash",
            Status = "Pending"
        };
    }

    private async Task SaveExpense()
    {
        await OnExpenseSaved.InvokeAsync(ExpenseForm);
        ClearExpenseForm();
    }
}

