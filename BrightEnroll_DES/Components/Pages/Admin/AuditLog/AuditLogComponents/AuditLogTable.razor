@namespace BrightEnroll_DES.Components.Pages.Admin.AuditLog.AuditLogComponents
@using BrightEnroll_DES.Components.Pages.Admin.AuditLog.AuditLogCS
@using BrightEnroll_DES.Components.Pages.Admin
@inject IJSRuntime JSRuntime
@* Audit Log Card Component with Filters *@

<!-- Filters -->
<div class="border-b border-gray-200 px-3 py-4 sm:px-6">
    <label class="mb-2 block text-sm font-bold text-gray-700">Filter:</label>
    <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <div class="flex flex-col gap-3 sm:flex-row sm:items-center">
            <div class="relative flex w-full items-center sm:w-auto sm:min-w-[200px]">
                <span class="absolute left-4 flex items-center justify-center">
                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </span>
                <div class="group relative w-full">
                    <input type="text" placeholder="Search here..." @bind="SearchText" @bind:after="OnSearchChanged"
                           class="w-full rounded-lg border border-gray-300 py-2 pl-11 pr-4 text-sm text-gray-700 outline-none focus:border-gray-300 focus:ring-2 focus:ring-blue-400" />
                    <span class="tooltip-delay">Search audit logs by user, action, module, description, or log ID</span>
                </div>
            </div>
            <div class="group relative">
                <select @bind="ModuleFilter" @bind:after="OnFilterChanged" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-600 outline-none focus:border-gray-300 focus:ring-2 focus:ring-blue-400 sm:w-auto">
                    <option value="">All Modules</option>
                    <option value="Authentication">Authentication</option>
                    <option value="Student Record">Student Record</option>
                    <option value="Human Resource">Human Resource</option>
                    <option value="Enrollment">Enrollment</option>
                    <option value="Finance">Finance</option>
                    <option value="Academics">Academics</option>
                    <option value="Archive">Archive</option>
                    <option value="Settings">Settings</option>
                </select>
                <span class="tooltip-delay">Filter logs by module category</span>
            </div>
            <div class="group relative">
                <select @bind="ActionFilter" @bind:after="OnFilterChanged" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-600 outline-none focus:border-gray-300 focus:ring-2 focus:ring-blue-400 sm:w-auto">
                    <option value="">All Actions</option>
                    <option value="User Login">User Login</option>
                    <option value="User Logout">User Logout</option>
                    <option value="Failed Login Attempt">Failed Login Attempt</option>
                    <option value="View Student Record">View Student Record</option>
                    <option value="Create Employee">Create Employee</option>
                    <option value="Update Employee">Update Employee</option>
                    <option value="Update Enrollment">Update Enrollment</option>
                    <option value="Assign Section">Assign Section</option>
                    <option value="Document Verification">Document Verification</option>
                    <option value="Process Payment">Process Payment</option>
                    <option value="Create Expense">Create Expense</option>
                    <option value="Export Report">Export Report</option>
                    <option value="Update Grade">Update Grade</option>
                    <option value="Archive Student">Archive Student</option>
                    <option value="Archive Employee">Archive Employee</option>
                    <option value="System Settings Change">System Settings Change</option>
                    <option value="Delete Record">Delete Record</option>
                </select>
                <span class="tooltip-delay">Filter logs by specific action type</span>
            </div>
            <div class="group relative">
                <select @bind="StatusFilter" @bind:after="OnFilterChanged" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-600 outline-none focus:border-gray-300 focus:ring-2 focus:ring-blue-400 sm:w-auto">
                    <option value="">All Status</option>
                    <option value="Success">Success</option>
                    <option value="Failed">Failed</option>
                </select>
                <span class="tooltip-delay">Filter logs by status (Success or Failed)</span>
            </div>
            <div class="group relative">
                <select @bind="SeverityFilter" @bind:after="OnFilterChanged" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-600 outline-none focus:border-gray-300 focus:ring-2 focus:ring-blue-400 sm:w-auto">
                    <option value="">All Severity</option>
                    <option value="Low">Low</option>
                    <option value="Moderate">Moderate</option>
                    <option value="High">High</option>
                </select>
                <span class="tooltip-delay">Filter logs by severity level (Low, Moderate, High)</span>
            </div>
            <div class="group relative">
                <select @bind="RoleFilter" @bind:after="OnFilterChanged" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-600 outline-none focus:border-gray-300 focus:ring-2 focus:ring-blue-400 sm:w-auto">
                    <option value="">All Roles</option>
                    <option value="Administrator">Administrator</option>
                    <option value="Teacher">Teacher</option>
                    <option value="Registrar">Registrar</option>
                    <option value="Cashier">Cashier</option>
                </select>
                <span class="tooltip-delay">Filter logs by user role</span>
            </div>
        </div>
        <div class="flex flex-col gap-3 sm:flex-row sm:items-center">
            <button @onclick="ClearFilters" class="flex w-full items-center justify-center gap-2 rounded-lg bg-gray-500 px-4 py-2 font-semibold text-white shadow-md transition-all duration-300 hover:bg-gray-600 hover:shadow-lg sm:w-auto" style="font-size: 13px;">
                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12" />
                </svg>
                Clear
            </button>
            <div class="group relative">
                <button @onclick="ExportPDF" class="flex w-full items-center justify-center gap-2 rounded-lg bg-blue-600 px-4 py-2 font-semibold text-white shadow-md transition-all duration-300 hover:bg-blue-700 hover:shadow-lg sm:w-auto" style="font-size: 13px;">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    Export
                </button>
                <span class="tooltip-delay">Export audit logs to PDF file</span>
            </div>
        </div>
    </div>
</div>

<!-- List View Container (Scrollable) -->
<div class="max-h-[450px] overflow-y-auto">
    @if (Logs != null && Logs.Any() && FilteredLogs.Any())
    {
        <div class="divide-y divide-gray-200">
            @foreach (var log in PaginatedLogs)
            {
                var isSelected = SelectedLog?.Id == log.Id;
                var isHovered = HoveredLog?.Id == log.Id;
                var isFirstLog = log == PaginatedLogs.First();
                var showBlueIndicator = isHovered || (isSelected && ShowDetailModal) || (isFirstLog && !ShowDetailModal && HoveredLog == null);
                <div @onclick="() => SelectLog(log)" 
                     @onmouseenter="() => HoverLog(log)"
                     @onmouseleave="() => HoverLog(null)"
                     class="group relative cursor-pointer px-4 py-4 transition-all duration-150 sm:px-6 @(isHovered ? "bg-gray-100" : "bg-white")">
                    <div class="absolute left-0 top-0 h-full w-1 transition-colors duration-150 @(showBlueIndicator ? "bg-blue-500" : "bg-gray-300")"></div>
                <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                    <!-- Left Section: Module, Action, Description -->
                    <div class="flex-1 min-w-0">
                        <div class="mb-2 flex flex-wrap items-center gap-2">
                            <span class="group relative inline-block rounded-full bg-gray-500 px-2.5 py-0.5 text-xs font-semibold text-white whitespace-nowrap">
                                @log.Module
                                <span class="tooltip-delay">Module: @log.Module</span>
                            </span>
                            <span class="group relative inline-block rounded-full px-2.5 py-0.5 text-xs font-medium @GetStatusClass(log.Status) whitespace-nowrap">
                                @log.Status
                                <span class="tooltip-delay">Status: @log.Status</span>
                            </span>
                            <span class="group relative inline-block rounded-full px-2.5 py-0.5 text-xs font-semibold @GetSeverityClass(log.Severity ?? "Low") whitespace-nowrap">
                                @(log.Severity ?? "Low")
                                <span class="tooltip-delay">Severity Level: @(log.Severity ?? "Low")</span>
                            </span>
                        </div>
                        <h3 class="mb-1 text-sm font-semibold text-blue-600">
                            @log.Action
                        </h3>
                        <p class="text-sm text-gray-600 line-clamp-1">@log.Description</p>
                    </div>

                    <!-- Middle Section: User, Role, Timestamp, IP -->
                    <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-6">
                        <div class="flex items-center gap-2 text-xs text-gray-600">
                            <svg class="h-4 w-4 flex-shrink-0 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                            <div class="flex flex-col sm:flex-row sm:gap-1">
                                <span class="font-medium text-gray-900">@log.User</span>
                                <span class="text-gray-500 sm:before:content-['â€¢'] sm:before:mx-1">@log.Role</span>
                            </div>
                        </div>
                        <div class="flex items-center gap-2 text-xs text-gray-500">
                            <svg class="h-4 w-4 flex-shrink-0 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span>@log.Timestamp.ToString("MMM dd, yyyy HH:mm")</span>
                        </div>
                        <div class="flex items-center gap-2 text-xs text-gray-500">
                            <svg class="h-4 w-4 flex-shrink-0 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
                            </svg>
                            <span>@log.IpAddress</span>
                        </div>
                    </div>

                    <!-- Right Section: View Button -->
                    <div class="flex items-center sm:ml-4">
                        <button @onclick="() => OpenDetailModal(log)" @onclick:stopPropagation="true"
                                class="flex items-center gap-1.5 rounded-lg bg-blue-50 px-3 py-1.5 text-xs font-medium text-blue-400 transition-colors hover:bg-blue-100">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                            <span class="hidden sm:inline">View</span>
                        </button>
                    </div>
                </div>
            </div>
        }
        </div>
    }
    else
    {
        <div class="flex flex-col items-center justify-center py-12">
            <svg class="h-16 w-16 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            <p class="text-base font-medium text-gray-600">No Audit Log Entries Found</p>
            <p class="text-sm text-gray-500 mt-1">There are no audit log entries matching your filters.</p>
        </div>
    }
</div>

<!-- Pagination Footer -->
@if (Logs != null && Logs.Any() && FilteredLogs.Any())
{
    <div class="flex items-center justify-between border-t border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-600">
        <span>@($"{((CurrentPage - 1) * RowsPerPage) + 1}-{Math.Min(CurrentPage * RowsPerPage, FilteredLogs.Count)} of {FilteredLogs.Count} audit log entries")</span>
        <div class="flex items-center gap-2">
            @if (TotalPages > 0)
            {
                @for (int i = 1; i <= Math.Min(TotalPages, 10); i++)
                {
                    <button @onclick="() => HandlePageChanged(i)" 
                            class="rounded-md px-3 py-1 text-xs @(i == CurrentPage ? "bg-blue-900 text-white" : "text-gray-600 hover:bg-gray-200")">
                        @i
                    </button>
                }
                @if (TotalPages > 10)
                {
                    <span>...</span>
                    <button @onclick="() => HandlePageChanged(TotalPages)" 
                            class="rounded-md px-3 py-1 text-xs text-gray-600 hover:bg-gray-200">
                        @TotalPages
                    </button>
                }
            }
            <span class="ml-4">Show</span>
            <div class="group relative">
                <select value="@RowsPerPage" @onchange="OnRowsPerPageChanged" 
                        class="rounded-md border px-2 py-1 text-xs text-gray-600">
                    <option value="5">5 rows</option>
                    <option value="10">10 rows</option>
                    <option value="20">20 rows</option>
                    <option value="50">50 rows</option>
                </select>
                <span class="tooltip-delay">Select number of audit log entries to display per page</span>
            </div>
        </div>
    </div>
}

<!-- Detail Modal -->
@if (SelectedLog != null && ShowDetailModal)
{
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4" @onclick="HandleBackdropClick">
        <div id="audit-log-detail-modal" class="w-full max-w-2xl rounded-xl bg-white shadow-2xl" @onclick:stopPropagation="true">
            <!-- Modal Header -->
            <div class="border-b border-gray-200 border-t-4 border-t-blue-500 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <div class="mb-2 flex flex-wrap items-center gap-2">
                            <span class="rounded-full bg-gray-500 px-3 py-1 text-xs font-semibold text-white">
                                @SelectedLog.Module
                            </span>
                            <span class="rounded-full px-3 py-1 text-xs font-medium @GetStatusClass(SelectedLog.Status)">
                                @SelectedLog.Status
                            </span>
                            <span class="rounded-full px-2 py-0.5 text-xs font-normal @GetSeverityClass(SelectedLog.Severity ?? "Low")">
                                @(SelectedLog.Severity ?? "Low")
                            </span>
                        </div>
                        <h2 class="text-xl font-bold text-blue-600">@SelectedLog.Action</h2>
                        <p class="mt-1 text-sm text-gray-500">Log ID: @SelectedLog.Id</p>
                    </div>
                    <button @onclick="CloseDetailModal" class="ml-4 rounded-lg p-2 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Modal Content -->
            <div class="max-h-[70vh] overflow-y-auto px-6 py-6">
                <div class="space-y-4">
                    <!-- Description -->
                    <div>
                        <label class="mb-1 block text-xs font-semibold uppercase tracking-wide text-gray-500">Description</label>
                        <p class="text-sm text-gray-900">@SelectedLog.Description</p>
                    </div>

                    <!-- User Information -->
                    <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                        <div>
                            <label class="mb-1 block text-xs font-semibold uppercase tracking-wide text-gray-500">User</label>
                            <p class="text-sm font-medium text-gray-900">@SelectedLog.User</p>
                        </div>
                        <div>
                            <label class="mb-1 block text-xs font-semibold uppercase tracking-wide text-gray-500">Role</label>
                            <p class="text-sm font-medium text-gray-900">@SelectedLog.Role</p>
                        </div>
                    </div>

                    <!-- Timestamp and IP -->
                    <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                        <div>
                            <label class="mb-1 block text-xs font-semibold uppercase tracking-wide text-gray-500">Timestamp</label>
                            <p class="text-sm font-medium text-gray-900">@SelectedLog.Timestamp.ToString("MMMM dd, yyyy 'at' HH:mm:ss")</p>
                        </div>
                        <div>
                            <label class="mb-1 block text-xs font-semibold uppercase tracking-wide text-gray-500">IP Address</label>
                            <p class="text-sm font-medium text-gray-900">@SelectedLog.IpAddress</p>
                        </div>
                    </div>

                    <!-- Module and Action -->
                    <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                        <div>
                            <label class="mb-1 block text-xs font-semibold uppercase tracking-wide text-gray-500">Module</label>
                            <p class="text-sm font-medium text-gray-900">@SelectedLog.Module</p>
                        </div>
                        <div>
                            <label class="mb-1 block text-xs font-semibold uppercase tracking-wide text-gray-500">Action</label>
                            <p class="text-sm font-medium text-gray-900">@SelectedLog.Action</p>
                        </div>
                    </div>

                    <!-- Status and Severity -->
                    <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                        <div>
                            <label class="mb-1 block text-xs font-semibold uppercase tracking-wide text-gray-500">Status</label>
                            <p class="text-sm font-medium text-gray-900">@SelectedLog.Status</p>
                        </div>
                        <div>
                            <label class="mb-1 block text-xs font-semibold uppercase tracking-wide text-gray-500">Severity</label>
                            <p class="text-sm font-medium text-gray-900">@(SelectedLog.Severity ?? "Low")</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="border-t border-gray-200 px-6 py-4">
                <div class="flex justify-end">
                    <button @onclick="CloseDetailModal" class="rounded-lg bg-gray-100 px-4 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-200">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>
}

@code {
    [Parameter]
    public List<AuditLogEntry>? Logs { get; set; }

    [Parameter]
    public int RowsPerPage { get; set; } = 10;

    // Filter properties
    private string SearchText { get; set; } = "";
    private string ModuleFilter { get; set; } = "";
    private string ActionFilter { get; set; } = "";
    private string StatusFilter { get; set; } = "";
    private string SeverityFilter { get; set; } = "";
    private string RoleFilter { get; set; } = "";
    private DateTime? FromDateFilter { get; set; }
    private DateTime? ToDateFilter { get; set; }

    // Pagination state
    private int CurrentPage { get; set; } = 1;
    private int TotalPages => FilteredLogs.Count > 0 ? (int)Math.Ceiling((double)FilteredLogs.Count / RowsPerPage) : 1;

    // Detail modal state
    private bool ShowDetailModal { get; set; } = false;
    private AuditLogEntry? SelectedLog { get; set; }
    private AuditLogEntry? HoveredLog { get; set; }
    private bool IsExplicitlySelected { get; set; } = false;

    // Computed property for filtered logs
    private List<AuditLogEntry> FilteredLogs
    {
        get
        {
            if (Logs == null || !Logs.Any())
                return new List<AuditLogEntry>();

            var filtered = Logs.AsEnumerable();

            // Search filter
            if (!string.IsNullOrWhiteSpace(SearchText))
            {
                var searchLower = SearchText.ToLower();
                filtered = filtered.Where(l =>
                    l.User.ToLower().Contains(searchLower) ||
                    l.Action.ToLower().Contains(searchLower) ||
                    l.Module.ToLower().Contains(searchLower) ||
                    l.Description.ToLower().Contains(searchLower) ||
                    l.Id.ToLower().Contains(searchLower)
                );
            }

            // Module filter
            if (!string.IsNullOrWhiteSpace(ModuleFilter))
            {
                filtered = filtered.Where(l => l.Module.Equals(ModuleFilter, StringComparison.OrdinalIgnoreCase));
            }

            // Action filter
            if (!string.IsNullOrWhiteSpace(ActionFilter))
            {
                filtered = filtered.Where(l => l.Action.Equals(ActionFilter, StringComparison.OrdinalIgnoreCase));
            }

            // Status filter
            if (!string.IsNullOrWhiteSpace(StatusFilter))
            {
                filtered = filtered.Where(l => l.Status.Equals(StatusFilter, StringComparison.OrdinalIgnoreCase));
            }

            // Severity filter
            if (!string.IsNullOrWhiteSpace(SeverityFilter))
            {
                filtered = filtered.Where(l => l.Severity.Equals(SeverityFilter, StringComparison.OrdinalIgnoreCase));
            }

            // Role filter
            if (!string.IsNullOrWhiteSpace(RoleFilter))
            {
                filtered = filtered.Where(l => l.Role.Equals(RoleFilter, StringComparison.OrdinalIgnoreCase));
            }

            // Date filter
            if (FromDateFilter.HasValue)
            {
                filtered = filtered.Where(l => l.Timestamp >= FromDateFilter.Value.Date);
            }

            if (ToDateFilter.HasValue)
            {
                filtered = filtered.Where(l => l.Timestamp <= ToDateFilter.Value.Date.AddDays(1).AddTicks(-1));
            }

            return filtered.OrderByDescending(l => l.Timestamp).ToList();
        }
    }

    // Computed property for paginated logs
    private List<AuditLogEntry> PaginatedLogs
    {
        get
        {
            var filtered = FilteredLogs;
            var paginated = filtered
                .Skip((CurrentPage - 1) * RowsPerPage)
                .Take(RowsPerPage)
                .ToList();
            
            // Set default selected log to first item if none selected or selected is not in current page
            if (paginated.Any())
            {
                if (SelectedLog == null || !paginated.Any(l => l.Id == SelectedLog.Id))
                {
                    SelectedLog = paginated.First();
                    IsExplicitlySelected = false; // Default selection, not explicit
                    StateHasChanged();
                }
            }
            
            return paginated;
        }
    }

    // Get module color (for Tailwind classes)
    private string GetModuleColor(string module)
    {
        return module switch
        {
            "Authentication" => "blue",
            "Student Record" => "green",
            "Human Resource" => "purple",
            "Enrollment" => "orange",
            "Finance" => "emerald",
            "Academics" => "indigo",
            "Archive" => "gray",
            "Settings" => "slate",
            _ => "gray"
        };
    }

    // Get module color hex (for inline styles)
    private string GetModuleColorHex(string module)
    {
        return module switch
        {
            "Authentication" => "#3b82f6",      // blue-500
            "Student Record" => "#10b981",      // green-500
            "Human Resource" => "#8b5cf6",       // purple-500
            "Enrollment" => "#f97316",          // orange-500
            "Finance" => "#059669",             // emerald-600
            "Academics" => "#6366f1",          // indigo-500
            "Archive" => "#6b7280",            // gray-500
            "Settings" => "#475569",           // slate-600
            _ => "#6b7280"                     // gray-500
        };
    }


    // Get status class
    private string GetStatusClass(string status)
    {
        return status switch
        {
            "Success" => "bg-green-100 text-green-700",
            "Failed" => "bg-red-100 text-red-700",
            "Warning" => "bg-yellow-100 text-yellow-700",
            _ => "bg-gray-100 text-gray-700"
        };
    }

    // Get severity class
    private string GetSeverityClass(string severity)
    {
        return severity switch
        {
            "Low" => "bg-blue-100 text-blue-700",
            "Moderate" => "bg-yellow-100 text-yellow-700",
            "High" => "bg-orange-100 text-orange-700",
            _ => "bg-gray-100 text-gray-700"
        };
    }

    public void ClearFilters()
    {
        SearchText = "";
        ModuleFilter = "";
        ActionFilter = "";
        StatusFilter = "";
        SeverityFilter = "";
        RoleFilter = "";
        FromDateFilter = null;
        ToDateFilter = null;
        CurrentPage = 1;
        StateHasChanged();
    }

    public void ClearAllFilters()
    {
        ClearFilters();
    }

    public void SetStatusFilter(string status)
    {
        StatusFilter = status;
        CurrentPage = 1;
        StateHasChanged();
    }

    public void SetDateFilter(DateTime fromDate, DateTime toDate)
    {
        FromDateFilter = fromDate;
        ToDateFilter = toDate;
        CurrentPage = 1;
        StateHasChanged();
    }

    private void OnSearchChanged()
    {
        CurrentPage = 1;
        SelectedLog = null; // Reset selection when filters change
        IsExplicitlySelected = false;
        StateHasChanged();
    }

    private void OnFilterChanged()
    {
        CurrentPage = 1;
        SelectedLog = null; // Reset selection when filters change
        IsExplicitlySelected = false;
        StateHasChanged();
    }

    private void HandlePageChanged(int page)
    {
        CurrentPage = page;
        StateHasChanged();
    }

    private void OnRowsPerPageChanged(ChangeEventArgs e)
    {
        if (int.TryParse(e.Value?.ToString(), out int rowsPerPage))
        {
            RowsPerPage = rowsPerPage;
            CurrentPage = 1;
            StateHasChanged();
        }
    }

    private void SelectLog(AuditLogEntry log)
    {
        // Don't persist selection when clicking on log entry - only for modal
        // This allows hover effect to work without persisting blue indicator
        StateHasChanged();
    }

    private void HoverLog(AuditLogEntry? log)
    {
        HoveredLog = log;
        StateHasChanged();
    }

    private void OpenDetailModal(AuditLogEntry log)
    {
        SelectedLog = log;
        IsExplicitlySelected = true; // Explicit selection via view button
        ShowDetailModal = true;
        StateHasChanged();
    }

    private void HandleBackdropClick()
    {
        // Allow closing audit log detail modal on backdrop click
        CloseDetailModal();
    }

    private void CloseDetailModal()
    {
        ShowDetailModal = false;
        // Reset to default (first item) when modal closes
        if (PaginatedLogs.Any())
        {
            SelectedLog = PaginatedLogs.First();
            IsExplicitlySelected = false;
        }
        StateHasChanged();
    }

    private void ExportPDF()
    {
        // Export PDF logic will be implemented here
    }
}
