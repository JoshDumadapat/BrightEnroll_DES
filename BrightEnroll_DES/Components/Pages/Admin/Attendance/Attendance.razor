@page "/attendance"
@layout Components.Layout.MainLayout
@using BrightEnroll_DES.Components.Pages.Admin.Attendance.AttendanceComponents
@using BrightEnroll_DES.Services.RoleBase
@using BrightEnroll_DES.Services.Business.Academic
@inject IAuthorizationService AuthorizationService
@inject SchoolYearService SchoolYearService

<PageTitle>Attendance</PageTitle>

<RoleAuthorizeView RequiredPermission="@Permissions.ViewAttendance">

<div class="text-gray-800">
    <div class="mb-6 flex items-center justify-between">
        <h1 class="text-2xl font-bold text-gray-800">Attendance Monitoring</h1>
        @if (!string.IsNullOrEmpty(CurrentSchoolYear))
        {
            <div class="flex items-center gap-2 rounded-lg border border-blue-200 bg-blue-50 px-4 py-2">
                <svg class="h-5 w-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                <span class="text-sm font-semibold text-blue-800">School Year: <span class="font-bold">@CurrentSchoolYear</span></span>
            </div>
        }
    </div>
    
    <!-- Tabs Card -->
    <div class="mb-6 overflow-hidden rounded-xl border-b border-gray-200 bg-white px-4 py-2 shadow">
        <div class="flex items-center gap-6">
            <button @onclick='() => SetActiveTab("daily")' 
                    class="@GetTabClasses("daily")">
                Daily Attendance
            </button>
            <button @onclick='() => SetActiveTab("records")' 
                    class="@GetTabClasses("records")">
                Attendance Records
            </button>
            <button @onclick='() => SetActiveTab("reports")' 
                    class="@GetTabClasses("reports")">
                Reports
            </button>
        </div>
    </div>

    <!-- Card Container -->
    <div class="overflow-hidden rounded-xl bg-white shadow">
        @if (activeTab == "daily")
        {
            <DailyAttendance />
        }
        else if (activeTab == "records")
        {
            <AttendanceRecords />
        }
        else if (activeTab == "reports")
        {
            <AttendanceReports />
        }
    </div>
</div>

@code {
    private string activeTab = "daily";
    private string CurrentSchoolYear { get; set; } = "";

    protected override async Task OnInitializedAsync()
    {
        // Load current school year
        CurrentSchoolYear = await SchoolYearService.GetActiveSchoolYearNameAsync() ?? "";
    }

    private void SetActiveTab(string tab)
    {
        activeTab = tab;
    }

    private string GetTabClasses(string tab)
    {
        var baseClasses = "px-4 py-2 text-sm font-semibold transition-colors duration-200 border-b-2";
        if (activeTab == tab)
        {
            return $"{baseClasses} border-blue-600 text-blue-600";
        }
        return $"{baseClasses} border-transparent text-gray-600 hover:text-gray-800";
    }
}

</RoleAuthorizeView>

