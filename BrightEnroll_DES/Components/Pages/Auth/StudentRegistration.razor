@page "/student-register"

@using BrightEnroll_DES.Services
@using BrightEnroll_DES.Models

@layout Components.Layout.EmptyLayout

<div class="min-h-screen bg-gray-100 py-4 px-2 sm:py-6 sm:px-4 md:py-8 md:px-6 lg:px-8">
    <div class="max-w-5xl mx-auto">
        <!-- Header -->
        <div class="bg-blue-600 text-white py-4 px-4 sm:py-5 sm:px-6 md:py-6 md:px-8 rounded-t-xl shadow-lg">
            <h1 class="text-lg sm:text-xl md:text-2xl font-semibold text-center">Registration Form</h1>
        </div>

        <!-- Form Content -->
        <div class="bg-white shadow-xl rounded-b-xl p-4 sm:p-6 md:p-8 lg:p-10" @onclick="HandleFormClick">
            <EditForm EditContext="@editContext" id="registration-form" @onsubmit:preventDefault="true">
                <DataAnnotationsValidator />

                <!-- Personal Information -->
                <div class="mb-6 sm:mb-8">
                    <h2 class="text-lg sm:text-xl font-bold text-blue-600 mb-4 sm:mb-6">Personal Information</h2>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-3 sm:mb-4">
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                First Name <span class="text-red-500">*</span>
                            </label>
                            <InputText @bind-Value="registrationModel.FirstName" 
                                       @bind-Value:after="FormatFirstName"
                                       class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm sm:text-base"
                                       placeholder="e.g. Juan" />
                            <ValidationMessage For="@(() => registrationModel.FirstName)" class="text-red-500 text-xs mt-1" />
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Middle Name</label>
                            <InputText @bind-Value="registrationModel.MiddleName" 
                                       @bind-Value:after="FormatMiddleName"
                                       class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm sm:text-base"
                                       placeholder="e.g. Dela Cruz" />
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                Last Name <span class="text-red-500">*</span>
                            </label>
                            <InputText @bind-Value="registrationModel.LastName" 
                                       @bind-Value:after="FormatLastName"
                                       class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm sm:text-base"
                                       placeholder="e.g. Santos" />
                            <ValidationMessage For="@(() => registrationModel.LastName)" class="text-red-500 text-xs mt-1" />
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Suffix</label>
                            <InputSelect @bind-Value="registrationModel.Suffix" 
                                class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm sm:text-base bg-white">
                                <option value="">N/A</option>
                                <option value="Jr.">Jr.</option>
                                <option value="Sr.">Sr.</option>
                                <option value="II">II</option>
                                <option value="III">III</option>
                                <option value="IV">IV</option>
                            </InputSelect>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-3 sm:mb-4">
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                Birth Date <span class="text-red-500">*</span>
                            </label>
                            <InputDate @bind-Value="registrationModel.BirthDate" @bind-Value:after="CalculateAge"
                                class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm sm:text-base" />
                            <ValidationMessage For="@(() => registrationModel.BirthDate)" class="text-red-500 text-xs mt-1" />
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                Age <span class="text-red-500">*</span>
                            </label>
                            <InputNumber @bind-Value="registrationModel.Age" 
                                class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm sm:text-base"
                                placeholder="e.g. 15" />
                            <ValidationMessage For="@(() => registrationModel.Age)" class="text-red-500 text-xs mt-1" />
                        </div>
                        <div class="relative">
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                Place of Birth <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <div @onclick="TogglePlaceOfBirthDropdown" 
                                     @onclick:stopPropagation="true"
                                     data-dropdown="placeofbirth"
                                     class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus-within:border-blue-500 focus-within:outline-none focus-within:ring-0 text-sm sm:text-base bg-white cursor-pointer flex items-center justify-between">
                                    <span class="@(string.IsNullOrWhiteSpace(registrationModel.PlaceOfBirth) ? "text-gray-400" : "text-gray-700")">
                                        @(string.IsNullOrWhiteSpace(registrationModel.PlaceOfBirth) ? "Select City" : registrationModel.PlaceOfBirth)
                                    </span>
                                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                    </svg>
                                </div>
                                @if (showPlaceOfBirthDropdown)
                                {
                                    <div class="absolute z-20 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg" @onclick:stopPropagation="true" data-dropdown="placeofbirth">
                                        <div class="p-2 border-b border-gray-200">
                                            <input type="text" 
                                                   @bind="placeOfBirthSearchText" 
                                                   @bind:after="FilterPlaceOfBirth"
                                                   @onkeydown="HandleSearchKeyDown"
                                                   @onkeydown:stopPropagation="true"
                                                   placeholder="Search city..."
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm" />
                                        </div>
                                        <div class="max-h-60 overflow-auto">
                                            @if (filteredPlaceOfBirthCities.Any())
                                            {
                                                @foreach (var city in filteredPlaceOfBirthCities)
                                                {
                                                    <div @onclick="() => SelectPlaceOfBirth(city)" 
                                                         class="px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm @(registrationModel.PlaceOfBirth == city ? "bg-blue-100" : "")">
                                                        @city
                                                    </div>
                                                }
                                            }
                                            else
                                            {
                                                <div class="px-4 py-2 text-sm text-gray-500">No results found</div>
                                            }
                                        </div>
                                    </div>
                                }
                            </div>
                            <ValidationMessage For="@(() => registrationModel.PlaceOfBirth)" class="text-red-500 text-xs mt-1" />
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                Sex <span class="text-red-500">*</span>
                            </label>
                            <InputRadioGroup @bind-Value="registrationModel.Sex">
                                <div class="flex items-center gap-4 sm:gap-6 pt-1 sm:pt-2">
                                    <label class="flex items-center cursor-pointer">
                                        <InputRadio Value="@("Male")" class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500" />
                                        <span class="ml-2 text-xs sm:text-sm text-gray-700">Male</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer">
                                        <InputRadio Value="@("Female")" class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500" />
                                        <span class="ml-2 text-xs sm:text-sm text-gray-700">Female</span>
                                    </label>
                                </div>
                            </InputRadioGroup>
                            <ValidationMessage For="@(() => registrationModel.Sex)" class="text-red-500 text-xs mt-1" />
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                Mother Tongue <span class="text-red-500">*</span>
                            </label>
                            <InputSelect @bind-Value="registrationModel.MotherTongue" 
                                class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm sm:text-base bg-white">
                                <option value="">Select</option>
                                <option value="Tagalog">Tagalog</option>
                                <option value="Cebuano">Cebuano</option>
                                <option value="Ilocano">Ilocano</option>
                                <option value="Hiligaynon">Hiligaynon</option>
                                <option value="Waray">Waray</option>
                                <option value="Other">Other</option>
                            </InputSelect>
                            <ValidationMessage For="@(() => registrationModel.MotherTongue)" class="text-red-500 text-xs mt-1" />
                            @if (registrationModel.MotherTongue == "Other")
                            {
                                <InputText @bind-Value="registrationModel.MotherTongueOther" 
                                    class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-sm sm:text-base mt-2"
                                    placeholder="Please specify mother tongue" />
                            }
                        </div>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                Indigenous Peoples (IP) Community?
                            </label>
                            <InputRadioGroup @bind-Value="registrationModel.IsIPCommunity">
                                <div class="flex items-center gap-3 sm:gap-4 pt-1 sm:pt-2">
                                    <label class="flex items-center cursor-pointer">
                                        <InputRadio Value="@("Yes")" class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500" />
                                        <span class="ml-2 text-xs sm:text-sm text-gray-700">Yes</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer">
                                        <InputRadio Value="@("No")" class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500" />
                                        <span class="ml-2 text-xs sm:text-sm text-gray-700">No</span>
                                    </label>
                                </div>
                            </InputRadioGroup>
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">If Yes, please specify:</label>
                            <InputSelect @bind-Value="registrationModel.IPCommunitySpecify" 
                                disabled="@(registrationModel.IsIPCommunity != "Yes")"
                                class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-sm sm:text-base bg-white disabled:bg-gray-100 disabled:cursor-not-allowed">
                                <option value="">N/A</option>
                                <option value="Lumad">Lumad</option>
                                <option value="Manobo">Manobo</option>
                                <option value="B'laan">B'laan</option>
                                <option value="Other">Other</option>
                            </InputSelect>
                            @if (registrationModel.IPCommunitySpecify == "Other" && registrationModel.IsIPCommunity == "Yes")
                            {
                                <InputText @bind-Value="registrationModel.IPCommunitySpecifyOther" 
                                    class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-sm sm:text-base mt-2"
                                    placeholder="Please specify" />
                            }
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                4Ps Beneficiary?
                            </label>
                            <InputRadioGroup @bind-Value="registrationModel.Is4PsBeneficiary">
                                <div class="flex items-center gap-3 sm:gap-4 pt-1 sm:pt-2">
                                    <label class="flex items-center cursor-pointer">
                                        <InputRadio Value="@("Yes")" class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500" />
                                        <span class="ml-2 text-xs sm:text-sm text-gray-700">Yes</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer">
                                        <InputRadio Value="@("No")" class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500" />
                                        <span class="ml-2 text-xs sm:text-sm text-gray-700">No</span>
                                    </label>
                                </div>
                            </InputRadioGroup>
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">If Yes, 4Ps Household ID:</label>
                            <InputText @bind-Value="registrationModel.FourPsHouseholdId" 
                                disabled="@(registrationModel.Is4PsBeneficiary != "Yes")"
                                class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-sm sm:text-base disabled:bg-gray-100 disabled:cursor-not-allowed"
                                placeholder="N/A" />
                        </div>
                    </div>
                </div>

                <hr class="my-6 sm:my-8 border-gray-200" />

                <!-- Current Address -->
                <div class="mb-6 sm:mb-8">
                    <h2 class="text-lg sm:text-xl font-bold text-blue-600 mb-4 sm:mb-6">Current Address</h2>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4 mb-3 sm:mb-4">
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">House No./Street</label>
                            <InputText @bind-Value="registrationModel.CurrentHouseNo" 
                                class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm sm:text-base"
                                placeholder="e.g. 123" />
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Street Name</label>
                            <InputText @bind-Value="registrationModel.CurrentStreetName" 
                                class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm sm:text-base"
                                placeholder="e.g. Rizal Street" />
                        </div>
                        <div class="relative">
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                Barangay <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <div @onclick="ToggleBarangayDropdown" 
                                     @onclick:stopPropagation="true"
                                     data-dropdown="barangay"
                                     class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus-within:border-blue-500 focus-within:outline-none focus-within:ring-0 text-sm sm:text-base bg-white cursor-pointer flex items-center justify-between">
                                    <span class="@(string.IsNullOrWhiteSpace(registrationModel.CurrentBarangay) ? "text-gray-400" : "text-gray-700")">
                                        @(string.IsNullOrWhiteSpace(registrationModel.CurrentBarangay) ? "Select Barangay" : registrationModel.CurrentBarangay)
                                    </span>
                                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                    </svg>
                                </div>
                                @if (currentAddressHandler?.ShowBarangayDropdown == true)
                                {
                                    <div class="absolute z-20 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg" @onclick:stopPropagation="true" data-dropdown="barangay">
                                        <div class="p-2 border-b border-gray-200">
                                            <input type="text" 
                                                   @bind="currentAddressHandler.BarangaySearchText" 
                                                   @bind:after="FilterBarangays"
                                                   @onkeydown="HandleSearchKeyDown"
                                                   @onkeydown:stopPropagation="true"
                                                   placeholder="Search barangay..."
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm" />
                                        </div>
                                        <div class="max-h-60 overflow-auto">
                                            @if (currentAddressHandler.FilteredBarangays.Any())
                                            {
                                                @foreach (var barangay in currentAddressHandler.FilteredBarangays)
                                                {
                                                    <div @onclick="() => SelectBarangay(barangay)" 
                                                         class="px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm @(registrationModel.CurrentBarangay == barangay ? "bg-blue-100" : "")">
                                                        @barangay
                                                    </div>
                                                }
                                            }
                                            else
                                            {
                                                <div class="px-4 py-2 text-sm text-gray-500">No results found</div>
                                            }
                                        </div>
                                    </div>
                                }
                            </div>
                            <ValidationMessage For="@(() => registrationModel.CurrentBarangay)" class="text-red-500 text-xs mt-1" />
                        </div>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
                        <div class="relative">
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                Province <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <div @onclick="ToggleProvinceDropdown" 
                                     @onclick:stopPropagation="true"
                                     data-dropdown="province"
                                     class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus-within:border-blue-500 focus-within:outline-none focus-within:ring-0 text-sm sm:text-base bg-white cursor-pointer flex items-center justify-between">
                                    <span class="@(string.IsNullOrWhiteSpace(registrationModel.CurrentProvince) ? "text-gray-400" : "text-gray-700")">
                                        @(string.IsNullOrWhiteSpace(registrationModel.CurrentProvince) ? "Select Province" : registrationModel.CurrentProvince)
                                    </span>
                                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                    </svg>
                                </div>
                                @if (currentAddressHandler?.ShowProvinceDropdown == true)
                                {
                                    <div class="absolute z-20 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg" @onclick:stopPropagation="true" data-dropdown="province">
                                        <div class="p-2 border-b border-gray-200">
                                            <input type="text" 
                                                   @bind="currentAddressHandler.ProvinceSearchText" 
                                                   @bind:after="FilterProvinces"
                                                   @onkeydown="HandleSearchKeyDown"
                                                   @onkeydown:stopPropagation="true"
                                                   placeholder="Search province..."
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm" />
                                        </div>
                                        <div class="max-h-60 overflow-auto">
                                            @if (currentAddressHandler.FilteredProvinces.Any())
                                            {
                                                @foreach (var province in currentAddressHandler.FilteredProvinces)
                                                {
                                                    <div @onclick="() => SelectProvince(province)" 
                                                         class="px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm @(registrationModel.CurrentProvince == province ? "bg-blue-100" : "")">
                                                        @province
                                                    </div>
                                                }
                                            }
                                            else
                                            {
                                                <div class="px-4 py-2 text-sm text-gray-500">No results found</div>
                                            }
                                        </div>
                                    </div>
                                }
                            </div>
                            <ValidationMessage For="@(() => registrationModel.CurrentProvince)" class="text-red-500 text-xs mt-1" />
                        </div>
                        <div class="relative">
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                Municipality/City <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <div @onclick="ToggleCityDropdown" 
                                     @onclick:stopPropagation="true"
                                     data-dropdown="city"
                                     class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus-within:border-blue-500 focus-within:outline-none focus-within:ring-0 text-sm sm:text-base bg-white cursor-pointer flex items-center justify-between">
                                    <span class="@(string.IsNullOrWhiteSpace(registrationModel.CurrentCity) ? "text-gray-400" : "text-gray-700")">
                                        @(string.IsNullOrWhiteSpace(registrationModel.CurrentCity) ? "Select City" : registrationModel.CurrentCity)
                                    </span>
                                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                    </svg>
                                </div>
                                @if (currentAddressHandler?.ShowCityDropdown == true)
                                {
                                    <div class="absolute z-20 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg" @onclick:stopPropagation="true" data-dropdown="city">
                                        <div class="p-2 border-b border-gray-200">
                                            <input type="text" 
                                                   @bind="currentAddressHandler.CitySearchText" 
                                                   @bind:after="FilterCities"
                                                   @onkeydown="HandleSearchKeyDown"
                                                   @onkeydown:stopPropagation="true"
                                                   placeholder="Search city..."
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm" />
                                        </div>
                                        <div class="max-h-60 overflow-auto">
                                            @if (currentAddressHandler.FilteredCities.Any())
                                            {
                                                @foreach (var city in currentAddressHandler.FilteredCities)
                                                {
                                                    <div @onclick="() => SelectCity(city)" 
                                                         class="px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm @(registrationModel.CurrentCity == city ? "bg-blue-100" : "")">
                                                        @city
                                                    </div>
                                                }
                                            }
                                            else
                                            {
                                                <div class="px-4 py-2 text-sm text-gray-500">No results found</div>
                                            }
                                        </div>
                                    </div>
                                }
                            </div>
                            <ValidationMessage For="@(() => registrationModel.CurrentCity)" class="text-red-500 text-xs mt-1" />
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                Country <span class="text-red-500">*</span>
                            </label>
                            <InputText @bind-Value="registrationModel.CurrentCountry" 
                                       @bind-Value:after="HandleCurrentCountryChange"
                                       disabled="@(currentAddressHandler?.IsCountryDisabled() == true)"
                                       class="@GetCurrentCountryClass()"
                                       placeholder="Country" />
                            <ValidationMessage For="@(() => registrationModel.CurrentCountry)" class="text-red-500 text-xs mt-1" />
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                ZIP Code <span class="text-red-500">*</span>
                            </label>
                            <InputText @bind-Value="registrationModel.CurrentZipCode" 
                                       disabled="@(currentAddressHandler?.IsCountryDisabled() == true)"
                                       class="@GetCurrentCountryClass()"
                                       placeholder="ZIP Code" />
                            <ValidationMessage For="@(() => registrationModel.CurrentZipCode)" class="text-red-500 text-xs mt-1" />
                        </div>
                    </div>
                </div>

                <hr class="my-6 sm:my-8 border-gray-200" />

                <!-- Permanent Address -->
                <div class="mb-6 sm:mb-8">
                    <h2 class="text-lg sm:text-xl font-bold text-blue-600 mb-4 sm:mb-6">Permanent Address</h2>
                    
                    <div class="mb-3 sm:mb-4">
                        <label class="flex items-center cursor-pointer">
                            <InputCheckbox @bind-Value="registrationModel.SameAsCurrentAddress" 
                                           @bind-Value:after="HandleSameAsCurrentAddressChange"
                                           class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                            <span class="ml-2 text-xs sm:text-sm font-medium text-gray-700">Same with your current Address?</span>
                        </label>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4 mb-3 sm:mb-4">
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">House No./Street</label>
                            <InputText @bind-Value="registrationModel.PermanentHouseNo" 
                                disabled="@registrationModel.SameAsCurrentAddress"
                                class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-sm sm:text-base disabled:bg-gray-100 disabled:cursor-not-allowed"
                                placeholder="House No./Street" />
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Street Name</label>
                            <InputText @bind-Value="registrationModel.PermanentStreetName" 
                                disabled="@registrationModel.SameAsCurrentAddress"
                                class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-sm sm:text-base disabled:bg-gray-100 disabled:cursor-not-allowed"
                                placeholder="Street Name" />
                        </div>
                        <div class="relative">
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                Barangay <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <div @onclick="TogglePermanentBarangayDropdown" 
                                     @onclick:stopPropagation="true"
                                     data-dropdown="permanent-barangay"
                                     class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus-within:border-blue-500 focus-within:outline-none text-sm sm:text-base bg-white cursor-pointer flex items-center justify-between @(registrationModel.SameAsCurrentAddress ? "bg-gray-100 cursor-not-allowed" : "")"
                                     style="@(registrationModel.SameAsCurrentAddress ? "pointer-events: none;" : "")">
                                    <span class="@(string.IsNullOrWhiteSpace(registrationModel.PermanentBarangay) ? "text-gray-400" : "text-gray-700")">
                                        @(string.IsNullOrWhiteSpace(registrationModel.PermanentBarangay) ? "Select Barangay" : registrationModel.PermanentBarangay)
                                    </span>
                                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                    </svg>
                                </div>
                                @if (permanentAddressHandler?.ShowBarangayDropdown == true && !registrationModel.SameAsCurrentAddress)
                                {
                                    <div class="absolute z-20 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg" @onclick:stopPropagation="true" data-dropdown="permanent-barangay">
                                        <div class="p-2 border-b border-gray-200">
                                            <input type="text" 
                                                   @bind="permanentAddressHandler.BarangaySearchText" 
                                                   @bind:after="FilterPermanentBarangays"
                                                   @onkeydown="HandleSearchKeyDown"
                                                   @onkeydown:stopPropagation="true"
                                                   placeholder="Search barangay..."
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm" />
                                        </div>
                                        <div class="max-h-60 overflow-auto">
                                            @if (permanentAddressHandler.FilteredBarangays.Any())
                                            {
                                                @foreach (var barangay in permanentAddressHandler.FilteredBarangays)
                                                {
                                                    <div @onclick="() => SelectPermanentBarangay(barangay)" 
                                                         class="px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm @(registrationModel.PermanentBarangay == barangay ? "bg-blue-100" : "")">
                                                        @barangay
                                                    </div>
                                                }
                                            }
                                            else
                                            {
                                                <div class="px-4 py-2 text-sm text-gray-500">No results found</div>
                                            }
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
                        <div class="relative">
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                Province <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <div @onclick="TogglePermanentProvinceDropdown" 
                                     @onclick:stopPropagation="true"
                                     data-dropdown="permanent-province"
                                     class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus-within:border-blue-500 focus-within:outline-none text-sm sm:text-base bg-white cursor-pointer flex items-center justify-between @(registrationModel.SameAsCurrentAddress ? "bg-gray-100 cursor-not-allowed" : "")"
                                     style="@(registrationModel.SameAsCurrentAddress ? "pointer-events: none;" : "")">
                                    <span class="@(string.IsNullOrWhiteSpace(registrationModel.PermanentProvince) ? "text-gray-400" : "text-gray-700")">
                                        @(string.IsNullOrWhiteSpace(registrationModel.PermanentProvince) ? "Select Province" : registrationModel.PermanentProvince)
                                    </span>
                                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                    </svg>
                                </div>
                                @if (permanentAddressHandler?.ShowProvinceDropdown == true && !registrationModel.SameAsCurrentAddress)
                                {
                                    <div class="absolute z-20 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg" @onclick:stopPropagation="true" data-dropdown="permanent-province">
                                        <div class="p-2 border-b border-gray-200">
                                            <input type="text" 
                                                   @bind="permanentAddressHandler.ProvinceSearchText" 
                                                   @bind:after="FilterPermanentProvinces"
                                                   @onkeydown="HandleSearchKeyDown"
                                                   @onkeydown:stopPropagation="true"
                                                   placeholder="Search province..."
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm" />
                                        </div>
                                        <div class="max-h-60 overflow-auto">
                                            @if (permanentAddressHandler.FilteredProvinces.Any())
                                            {
                                                @foreach (var province in permanentAddressHandler.FilteredProvinces)
                                                {
                                                    <div @onclick="() => SelectPermanentProvince(province)" 
                                                         class="px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm @(registrationModel.PermanentProvince == province ? "bg-blue-100" : "")">
                                                        @province
                                                    </div>
                                                }
                                            }
                                            else
                                            {
                                                <div class="px-4 py-2 text-sm text-gray-500">No results found</div>
                                            }
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                        <div class="relative">
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                Municipality/City <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <div @onclick="TogglePermanentCityDropdown" 
                                     @onclick:stopPropagation="true"
                                     data-dropdown="permanent-city"
                                     class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus-within:border-blue-500 focus-within:outline-none text-sm sm:text-base bg-white cursor-pointer flex items-center justify-between @(registrationModel.SameAsCurrentAddress ? "bg-gray-100 cursor-not-allowed" : "")"
                                     style="@(registrationModel.SameAsCurrentAddress ? "pointer-events: none;" : "")">
                                    <span class="@(string.IsNullOrWhiteSpace(registrationModel.PermanentCity) ? "text-gray-400" : "text-gray-700")">
                                        @(string.IsNullOrWhiteSpace(registrationModel.PermanentCity) ? "Select City" : registrationModel.PermanentCity)
                                    </span>
                                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                    </svg>
                                </div>
                                @if (permanentAddressHandler?.ShowCityDropdown == true && !registrationModel.SameAsCurrentAddress)
                                {
                                    <div class="absolute z-20 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg" @onclick:stopPropagation="true" data-dropdown="permanent-city">
                                        <div class="p-2 border-b border-gray-200">
                                            <input type="text" 
                                                   @bind="permanentAddressHandler.CitySearchText" 
                                                   @bind:after="FilterPermanentCities"
                                                   @onkeydown="HandleSearchKeyDown"
                                                   @onkeydown:stopPropagation="true"
                                                   placeholder="Search city..."
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm" />
                                        </div>
                                        <div class="max-h-60 overflow-auto">
                                            @if (permanentAddressHandler.FilteredCities.Any())
                                            {
                                                @foreach (var city in permanentAddressHandler.FilteredCities)
                                                {
                                                    <div @onclick="() => SelectPermanentCity(city)" 
                                                         class="px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm @(registrationModel.PermanentCity == city ? "bg-blue-100" : "")">
                                                        @city
                                                    </div>
                                                }
                                            }
                                            else
                                            {
                                                <div class="px-4 py-2 text-sm text-gray-500">No results found</div>
                                            }
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                Country <span class="text-red-500">*</span>
                            </label>
                            <InputText @bind-Value="registrationModel.PermanentCountry" 
                                       @bind-Value:after="HandlePermanentCountryChange"
                                       disabled="@(registrationModel.SameAsCurrentAddress || permanentAddressHandler?.IsCountryDisabled() == true)"
                                       class="@GetPermanentCountryClass()"
                                       placeholder="Country" />
                            <ValidationMessage For="@(() => registrationModel.PermanentCountry)" class="text-red-500 text-xs mt-1" />
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                ZIP Code <span class="text-red-500">*</span>
                            </label>
                            <InputText @bind-Value="registrationModel.PermanentZipCode" 
                                       disabled="@(registrationModel.SameAsCurrentAddress || permanentAddressHandler?.IsCountryDisabled() == true)"
                                       class="@GetPermanentCountryClass()"
                                       placeholder="ZIP Code" />
                        </div>
                    </div>
                </div>

                <hr class="my-6 sm:my-8 border-gray-200" />

                <!-- Guardian Information -->
                <div class="mb-6 sm:mb-8">
                    <h2 class="text-lg sm:text-xl font-bold text-blue-600 mb-4 sm:mb-6">Guardian Information</h2>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-3 sm:mb-4">
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                First Name <span class="text-red-500">*</span>
                            </label>
                            <InputText @bind-Value="registrationModel.GuardianFirstName" 
                                       @bind-Value:after="FormatGuardianFirstName"
                                       class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm sm:text-base"
                                       placeholder="e.g. Maria" />
                            <ValidationMessage For="@(() => registrationModel.GuardianFirstName)" class="text-red-500 text-xs mt-1" />
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Middle Name</label>
                            <InputText @bind-Value="registrationModel.GuardianMiddleName" 
                                       @bind-Value:after="FormatGuardianMiddleName"
                                       class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm sm:text-base"
                                       placeholder="Middle Name" />
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                Last Name <span class="text-red-500">*</span>
                            </label>
                            <InputText @bind-Value="registrationModel.GuardianLastName" 
                                       @bind-Value:after="FormatGuardianLastName"
                                       class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm sm:text-base"
                                       placeholder="Last Name" />
                            <ValidationMessage For="@(() => registrationModel.GuardianLastName)" class="text-red-500 text-xs mt-1" />
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Suffix</label>
                            <InputSelect @bind-Value="registrationModel.GuardianSuffix" 
                                class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm sm:text-base bg-white">
                                <option value="">N/A</option>
                                <option value="Jr.">Jr.</option>
                                <option value="Sr.">Sr.</option>
                                <option value="II">II</option>
                                <option value="III">III</option>
                                <option value="IV">IV</option>
                            </InputSelect>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-3 sm:mb-4">
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                Contact Number <span class="text-red-500">*</span>
                            </label>
                            <InputText @bind-Value="registrationModel.GuardianContactNumber" 
                                       maxlength="11"
                                       onkeypress="return /[0-9]/i.test(event.key) || event.key === 'Backspace' || event.key === 'Delete' || event.key === 'ArrowLeft' || event.key === 'ArrowRight'"
                                       class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm sm:text-base"
                                       placeholder="e.g. 09123456789" />
                            <ValidationMessage For="@(() => registrationModel.GuardianContactNumber)" class="text-red-500 text-xs mt-1" />
                        </div>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                Relationship <span class="text-red-500">*</span>
                            </label>
                            <InputSelect @bind-Value="registrationModel.GuardianRelationship" 
                                class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm sm:text-base bg-white">
                                <option value="">Select Relationship</option>
                                <option value="Father">Father</option>
                                <option value="Mother">Mother</option>
                                <option value="Guardian">Guardian</option>
                                <option value="Other">Other</option>
                            </InputSelect>
                            <ValidationMessage For="@(() => registrationModel.GuardianRelationship)" class="text-red-500 text-xs mt-1" />
                        </div>
                        @if (registrationModel.GuardianRelationship == "Other")
                        {
                            <div>
                                <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                    Please specify:
                                </label>
                                <InputText @bind-Value="registrationModel.GuardianRelationshipOther" 
                                    class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm sm:text-base"
                                    placeholder="e.g. Yaya" />
                            </div>
                        }
                    </div>
                </div>

                <hr class="my-6 sm:my-8 border-gray-200" />

                <!-- Enrollment Details -->
                <div class="mb-6 sm:mb-8">
                    <h2 class="text-lg sm:text-xl font-bold text-blue-600 mb-4 sm:mb-6">Enrollment Details</h2>
                    
                    <div class="mb-4 sm:mb-6">
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-2 sm:mb-3">
                            Student Type <span class="text-red-500">*</span>
                        </label>
                        <InputRadioGroup @bind-Value="registrationModel.StudentType">
                            <div class="flex flex-wrap gap-4 sm:gap-6">
                                <label class="flex items-center cursor-pointer">
                                    <InputRadio Value="@("New Student")" class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500" />
                                    <span class="ml-2 text-xs sm:text-sm text-gray-700">New Student</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <InputRadio Value="@("Returnee")" class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500" />
                                    <span class="ml-2 text-xs sm:text-sm text-gray-700">Returnee</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <InputRadio Value="@("Transferee")" class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500" />
                                    <span class="ml-2 text-xs sm:text-sm text-gray-700">Transferee</span>
                                </label>
                            </div>
                        </InputRadioGroup>
                        <ValidationMessage For="@(() => registrationModel.StudentType)" class="text-red-500 text-xs mt-1" />
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-4 sm:mb-6">
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">With LRN?</label>
                            <InputRadioGroup @bind-Value="registrationModel.HasLRN" @bind-Value:after="HandleHasLRNChange">
                                <div class="flex items-center gap-3 sm:gap-4 pt-1 sm:pt-2">
                                    <label class="flex items-center cursor-pointer">
                                        <InputRadio Value="@("Yes")" class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500" />
                                        <span class="ml-2 text-xs sm:text-sm text-gray-700">Yes</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer">
                                        <InputRadio Value="@("No")" class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500" />
                                        <span class="ml-2 text-xs sm:text-sm text-gray-700">No</span>
                                    </label>
                                </div>
                            </InputRadioGroup>
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                Learner Reference No. <span class="text-red-500">*</span>
                            </label>
                            <InputText @bind-Value="registrationModel.LearnerReferenceNo" 
                                @bind-Value:after="HandleLRNChange"
                                disabled="@(registrationModel.HasLRN != "Yes")"
                                maxlength="12"
                                onkeypress="return /[0-9]/i.test(event.key)"
                                class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-sm sm:text-base disabled:bg-gray-100 disabled:cursor-not-allowed"
                                placeholder="e.g. 123456789012" />
                            <ValidationMessage For="@(() => registrationModel.LearnerReferenceNo)" class="text-red-500 text-xs mt-1" />
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                School year <span class="text-red-500">*</span>
                            </label>
                            <InputSelect @bind-Value="registrationModel.SchoolYear" @bind-Value:after="OnSchoolYearChanged"
                                class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm sm:text-base bg-white">
                                <option value="" disabled selected>Select School Year</option>
                                <option value="ADD_NEW">+ Add School Year</option>
                                @foreach (var schoolYear in availableSchoolYears)
                                {
                                    <option value="@schoolYear">@schoolYear</option>
                                }
                            </InputSelect>
                            <ValidationMessage For="@(() => registrationModel.SchoolYear)" class="text-red-500 text-xs mt-1" />
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                Grade to Enroll <span class="text-red-500">*</span>
                            </label>
                            <InputSelect @bind-Value="registrationModel.GradeToEnroll" 
                                class="w-full px-3 py-2 sm:px-4 sm:py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-0 text-sm sm:text-base bg-white">
                                <option value="" disabled selected>Select Grade</option>
                                <option value="Pre-school">Pre-school</option>
                                <option value="Kinder">Kinder</option>
                                <option value="Grade 1">Grade 1</option>
                                <option value="Grade 2">Grade 2</option>
                                <option value="Grade 3">Grade 3</option>
                                <option value="Grade 4">Grade 4</option>
                                <option value="Grade 5">Grade 5</option>
                                <option value="Grade 6">Grade 6</option>
                            </InputSelect>
                            <ValidationMessage For="@(() => registrationModel.GradeToEnroll)" class="text-red-500 text-xs mt-1" />
                        </div>
                    </div>
                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-3 sm:p-4 mb-4 sm:mb-6">
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-2 sm:mb-3">
                            Requirements <span class="text-red-500">*</span>
                        </label>
                        <div class="space-y-2">
                            @if (registrationModel.StudentType == "New Student")
                            {
                                <label class="flex items-center cursor-pointer">
                                    <InputCheckbox @bind-Value="registrationModel.HasPSABirthCert" 
                                        class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                                    <span class="ml-2 text-xs sm:text-sm text-gray-700">PSA Birth Certificate (photocopy & original for verification)</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <InputCheckbox @bind-Value="registrationModel.HasBaptismalCert" 
                                        class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                                    <span class="ml-2 text-xs sm:text-sm text-gray-700">Baptismal Certificate (if applicable, for Catholic schools)</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <InputCheckbox @bind-Value="registrationModel.HasReportCard" 
                                        class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                                    <span class="ml-2 text-xs sm:text-sm text-gray-700">Report Card / Form 138 (from preschool if available)</span>
                                </label>
                            }
                            else if (registrationModel.StudentType == "Transferee")
                            {
                                <label class="flex items-center cursor-pointer">
                                    <InputCheckbox @bind-Value="registrationModel.HasPSABirthCert" 
                                        class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                                    <span class="ml-2 text-xs sm:text-sm text-gray-700">PSA Birth Certificate</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <InputCheckbox @bind-Value="registrationModel.HasBaptismalCert" 
                                        class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                                    <span class="ml-2 text-xs sm:text-sm text-gray-700">Baptismal Certificate (if applicable)</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <InputCheckbox @bind-Value="registrationModel.HasForm138" 
                                        class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                                    <span class="ml-2 text-xs sm:text-sm text-gray-700">Form 138 (Report Card)</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <InputCheckbox @bind-Value="registrationModel.HasForm137" 
                                        class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                                    <span class="ml-2 text-xs sm:text-sm text-gray-700">Form 137 (Permanent Record)  requested from previous school</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <InputCheckbox @bind-Value="registrationModel.HasGoodMoralCert" 
                                        class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                                    <span class="ml-2 text-xs sm:text-sm text-gray-700">Certificate of Good Moral Character</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <InputCheckbox @bind-Value="registrationModel.HasTransferCert" 
                                        class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                                    <span class="ml-2 text-xs sm:text-sm text-gray-700">Transfer Certificate / Honorable Dismissal</span>
                                </label>
                            }
                            else if (registrationModel.StudentType == "Returnee")
                            {
                                <label class="flex items-center cursor-pointer">
                                    <InputCheckbox @bind-Value="registrationModel.HasForm138" 
                                        class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                                    <span class="ml-2 text-xs sm:text-sm text-gray-700">Form 138 (Report Card)</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <InputCheckbox @bind-Value="registrationModel.HasUpdatedEnrollmentForm" 
                                        class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                                    <span class="ml-2 text-xs sm:text-sm text-gray-700">Updated Enrollment Form</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <InputCheckbox @bind-Value="registrationModel.HasClearance" 
                                        class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                                    <span class="ml-2 text-xs sm:text-sm text-gray-700">Clearance (if required)</span>
                                </label>
                            }
                        </div>
                    </div>
                    <div class="bg-green-50 border border-green-200 rounded-lg p-3 sm:p-4">
                        <label class="flex items-start cursor-pointer">
                            <InputCheckbox @bind-Value="registrationModel.AgreeToTerms" 
                                class="w-4 h-4 sm:w-5 sm:h-5 text-green-600 border-gray-300 rounded focus:ring-green-500 mt-0.5" />
                            <span class="ml-2 sm:ml-3 text-xs sm:text-sm text-gray-700">
                                I agree to the <a href="#" @onclick="OpenTermsModal" @onclick:preventDefault class="text-[#0040B6] hover:underline font-medium">Terms of Enrollment and Privacy Policy</a> of BrightEnroll, and consent to the processing of my personal data.
                            </span>
                        </label>
                        <ValidationMessage For="@(() => registrationModel.AgreeToTerms)" class="text-red-500 text-xs mt-2 ml-6 sm:ml-8" />
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center mt-6 sm:mt-8">
                    <button type="button" 
                        @onclick="Cancel"
                        @onkeydown:preventDefault="true"
                        class="px-6 sm:px-8 py-2.5 sm:py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-full transition-all duration-300 shadow-md hover:shadow-lg min-w-[140px] sm:min-w-[160px] text-sm sm:text-base">
                        Cancel
                    </button>
                    <button type="button" 
                        @onclick="HandleSubmitClick"
                        @onkeydown:preventDefault="true"
                        disabled="@isSubmitting"
                        class="px-6 sm:px-8 py-2.5 sm:py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-full transition-all duration-300 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed min-w-[140px] sm:min-w-[160px] text-sm sm:text-base">
                        @if (isSubmitting)
                        {
                            <span class="inline-flex items-center justify-center">
                                <svg class="animate-spin -ml-1 mr-2 sm:mr-3 h-4 w-4 sm:h-5 sm:w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                <span>Submitting...</span>
                            </span>
                        }
                        else
                        {
                            <span>Submit</span>
                        }
                    </button>
                </div>
            </EditForm>
        </div>
    </div>
</div>

<!-- Terms and Privacy Policy Modal -->
<TermsModal Show="@showTermsModal" OnClose="CloseTermsModal" OnUnderstand="HandleTermsUnderstand" />

<!-- Add School Year Modal -->
@if (showAddSchoolYearModal)
{
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50" @onclick="CloseAddSchoolYearModal">
        <div class="w-full max-w-md rounded-lg bg-white shadow-xl" @onclick:stopPropagation="true">
            <div class="flex items-center justify-between rounded-t-lg bg-blue-600 px-6 py-4">
                <h3 class="text-lg font-semibold text-white">Add School Year</h3>
                <button @onclick="CloseAddSchoolYearModal" class="text-white hover:text-gray-200">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="px-6 py-4">
                <div class="mb-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="mb-2 block text-sm font-medium text-gray-700">
                                Start Year <span class="text-red-500">*</span>
                            </label>
                            <InputSelect @bind-Value="startYear" @bind-Value:after="OnStartYearChanged"
                                         class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 outline-none focus:border-blue-500 focus:outline-none focus:ring-0">
                                <option value="" disabled selected>Select Start Year</option>
                                @foreach (var year in availableStartYears)
                                {
                                    <option value="@year">@year</option>
                                }
                            </InputSelect>
                        </div>
                        <div>
                            <label class="mb-2 block text-sm font-medium text-gray-700">
                                End Year <span class="text-red-500">*</span>
                            </label>
                            <InputSelect @bind-Value="endYear" @bind-Value:after="ValidateSchoolYearFormat"
                                         class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 outline-none focus:border-blue-500 focus:outline-none focus:ring-0"
                                         disabled="@(string.IsNullOrWhiteSpace(startYear))">
                                <option value="" disabled selected>Select End Year</option>
                                @if (!string.IsNullOrWhiteSpace(startYear) && int.TryParse(startYear, out int start))
                                {
                                    <option value="@(start + 1)">@(start + 1)</option>
                                }
                            </InputSelect>
                        </div>
                    </div>
                    @if (!string.IsNullOrWhiteSpace(schoolYearValidationError))
                    {
                        <p class="mt-2 text-xs text-red-500">@schoolYearValidationError</p>
                    }
                    else
                    {
                        <p class="mt-2 text-xs text-gray-500">Format: Start Year must be exactly 1 year before End Year (e.g., 2027-2028)</p>
                    }
                </div>
                <div class="flex justify-end gap-3">
                    <button type="button" @onclick="CloseAddSchoolYearModal" 
                            class="rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">
                        Cancel
                    </button>
                    <button type="button" @onclick="AddSchoolYear" 
                            disabled="@(string.IsNullOrWhiteSpace(startYear) || string.IsNullOrWhiteSpace(endYear) || !isValidSchoolYearFormat || availableSchoolYears.Count >= 3)"
                            class="rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed">
                        Add
                    </button>
                </div>
            </div>
        </div>
    </div>
}

